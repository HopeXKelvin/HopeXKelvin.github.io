# 手势解锁说明文档  

## 总体设计思路：  
首先布局方面，页面顶部是header，中间部分利用flex布局实现九宫格布局(9个手势点)，底部放置了两个按钮。实现的思路是，初始化页面的时候，存放好9个点的坐标信息，数据结构如下所示:  

```javascript
  {
    x : [left,right],//存放这个点的水平坐标范围
    y : [top,bottom],//存放这个点的竖直方向的坐标范围
    pos : [xpos,ypos],//存放该圆点的中心点的坐标值(在页面中的)
    hasTap : true,// 标识该点是否已经被滑动经过
    id : ""// 该点对应dom结构的id值，方便后面查找到dom结构
  }
```  

存放了9个点的信息后，渲染一个全屏的canvas画布(用于画点与点之间的连线)，画线是通过每个手势点的中心坐标去连接的。然后开始绑定事件，包括touchstart,touchmove,touchend这三个屏幕点击以及滑动的操作，同时还需要绑定两个按钮的相关点击事件。当用户触摸屏幕的解锁部分的时候，会触发事件，内部会检测用户划过的区域是否在9个点的坐标范围内，如果在，就给那个点添加一个激活的类active，并且表示它是被划过的点，并且会将这个点存入到密码序列里。根据是在设置状态下，还是在检验状态下，分别会有不同的行为。  
设置状态下，两次滑动的序列一致的情况下会提示设置成功，否则会提示设置失败，会重置，用户可以重新设置。  
验证状态下，会把一次的收拾序列与存放在localStorage里面的密码序列作比较，匹配就提示密码验证成功，否则提示密码匹配失败。

## 文件结构：  
- HTML:本部分主要是定义了手势解锁的布局，最重要的中间部分的9个点的布局用一个大的DIV包裹了9个DIV分别代表9个点。其他部分都是比较简单的布局  

- CSS:本部分，重点和难点在于九宫格的布局(9个点)，使用了flex去布局。设置了flex-wrap:wrap;让下面的9个点自动换行。  

- JS:本部分比较重要。定义了一些全局都可以使用的变量。定义了一下几个方法 :  


  |方法|参数|作用|
  |------|------|-------|
  |init()|-|初始化调用方法，相当于JS文件的一个入口函数|
  |savePointInfo()|-|存储页面中9个手势点的坐标以及状态信息|
  |renderCanvas()|-|渲染canvas用于后面画连线|
  |bindEvent()|-|集中绑定页面中的各种事件|
  |tapPoint()|[xpos(number),ypos(number)]|用于检测当前手指滑到的位置是否触碰到了手势点，两个参数分别代表当前手指在屏幕上的 x和y轴的坐标值，如果触碰到了就改变手势点的状态，并且会修改密码序列数据|
  |popTips()|[msg(string)]|这个函数相当于一个辅助函数，主要是用于显示各种提示信息的。每次用户操作的时候会有对应的提示，都是传入不同的文本，调用该方法更新，显示对应的提示，并且内部设置了定时器，定时800毫秒之后，关闭提示|  

  ## 实践过程中遇到的一些坑：  

  1. 九宫格布局(flex)  

  2. canvas的 width和heigh 设置需要注意，并不是设置 canvas.style.width 而是canvas.width.一开始用的前面的那种方式给canvas设置宽高，结果怎么画线坐标都对不上，后来才发现要直接设置canvas的width 和 height  

  3. localStorage是永久存在于浏览器当中的，所以每一次进入页面的时候都需要清空一下  

  4. canvas画线，横竖方向的粗细程度不一致，后来把线条的宽度加大了，好多了
